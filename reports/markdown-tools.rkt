#lang racket

(require reports/tools-common)

(provide (all-defined-out))

(define-syntax (mode stx)
  (syntax-case stx ()
    [(_ delimitor . rest)
     #'(begin (text delimitor)
	      ((lambda () . rest))
	      (text delimitor))]))

(define-syntax (make-mode stx)
  (syntax-case stx ()
    [(_ delimitor name)
     #'(define-syntax (name stx)
	 (syntax-case stx ()
	   [(_ . rest)
	    #'(mode delimitor . rest)]))]))

(make-mode '** bold)

(define (make-heading heading-text)
  (text heading-text)
  (newline)
  (text "=====")
  (newline)
  (newline))

(define (make-table labels data #:modifier-alist [modifiers '()] #:row-links [links (make-list (length data) '())])
  (text "|")
  (for/list ([label labels])
    (text label "\t\t|"))
  (newline)
  (text "|")
  (for/list ([label labels])
    (text ":------:|"))
  (for/list ([datum data] [link links])
    (newline)
    (text "|")
    (for/list ([cell datum])
      (when (not (null? link)) (text "["))
      (for/list ([modifier modifiers])
       	(when ((car modifier) datum) (text "<span style=\"color:" (cdr modifier) "\">")))
      (text cell)
      (for/list ([modifier modifiers])
       	(when ((car modifier) datum) (text "</span>")))
      (when (not (null? link)) (text "](" link ")"))
      (text "|")))
  (void))
